import os
from typing import List

import torch
import numpy as np

DQN_MODEL_PATH: str = os.path.join(os.getcwd(), "dqn/models/latest_checkpoint.pt")
UPDATE_FREQ: float = 30
BATCH_SIZE: int = 64
MAX_TRAIN_STEPS: int = 100_000_000

MODEL_TYPE: str = "Reinformer"
DATASET_DIR: str = "assets"
CONTEXT_LEN: int = 40
N_BLOCKS: int = 4
EMBED_DIM: int = 512
N_HEADS: int = 2
DROPOUT_P: float = 0.1
GRAD_NORM: float = 0.25
TAU: float = 0.99
BATCH_SIZE: int = 64
LR: float = 1e-4
WD: float = 1e-4
WARMUP_STEPS: int = 5000
MAX_TRAIN_ITERS: int = 10
NUM_UPDATES_PER_ITER: int = 5000
DEVICE: str = "cuda:1" if torch.cuda.is_available() else "cpu"
SEED: int = 2024
INIT_TEMPERATURE: float = 0.1
USE_WANDB: bool = True
STATE_DIM: int = 415
ACT_DIM: int = 2
MODEL_PATH: str = os.path.join(os.getcwd(), "Reinformer/models/latest_checkpoint.pt")

STATE_MEAN: np.ndarray = np.array([
    4.29506613e-06, -1.55903485e-03, 1.00284099e-02, -1.54011896e-03, 2.00235243e-02, -1.49873045e-03, 3.00143817e-02, -1.43551753e-03, 4.00014132e-02, -1.34992234e-03, 4.99830984e-02, -1.24216506e-03, 5.99570543e-02, -1.11212241e-03, 6.99236708e-02, -9.60169571e-04, 7.98823151e-02, -7.85940594e-04, 8.98324801e-02, -5.89457910e-04, 9.97718003e-02, -3.70999189e-04, 1.09699242e-01, -1.30546748e-04, 1.19614473e-01, 1.32369447e-04, 1.29517018e-01, 4.16948158e-04, 1.39405190e-01, 7.23563818e-04, 1.49278807e-01, 1.05208135e-03, 1.59140728e-01, 1.40276641e-03, 1.68981879e-01, 1.77534697e-03, 1.78809968e-01, 2.16973064e-03, 1.88617824e-01, 2.58568005e-03, 1.98408118e-01, 3.02348175e-03, 2.08177147e-01, 3.48347440e-03, 2.17927063e-01, 3.96460314e-03, 2.27652872e-01, 4.46803224e-03, 2.37359113e-01, 4.99254935e-03, 2.47040909e-01, 5.53894158e-03, 2.56700927e-01, 6.10691644e-03, 2.66335172e-01, 6.69606802e-03, 2.75945701e-01, 7.30714131e-03, 2.85530417e-01, 7.93849329e-03, 2.95088465e-01, 8.59178149e-03, 3.04620799e-01, 9.26678807e-03, 3.14125950e-01, 9.96224307e-03, 3.23600654e-01, 1.06778797e-02, 3.33047829e-01, 1.14153730e-02, 3.42465075e-01, 1.21726586e-02, 3.51851951e-01, 1.29511001e-02, 3.61208198e-01, 1.37489961e-02, 3.70533829e-01, 1.45689392e-02, 3.79828500e-01, 1.54076563e-02, 
    3.89090376e-01, 1.62668065e-02, 3.98317743e-01, 1.71457451e-02, 4.07510936e-01, 1.80445334e-02, 4.16670554e-01, 1.89630687e-02, 4.25795929e-01, 1.99023964e-02, 4.34883844e-01, 2.08596695e-02, 4.43939099e-01, 2.18365193e-02, 4.52956944e-01, 2.28321893e-02, 4.61938195e-01, 2.38468718e-02, 4.70882853e-01, 2.48810476e-02, 4.79787352e-01, 2.59331307e-02, 4.88654782e-01, 2.70033837e-02, 4.97484360e-01, 2.80910542e-02, 5.06275076e-01, 2.91985526e-02, 5.15026921e-01, 3.03232178e-02, 5.23737623e-01, 3.14652916e-02, 5.32409114e-01, 3.26246103e-02, 5.41038606e-01, 3.38018272e-02, 5.49629545e-01, 3.49966979e-02, 5.58177675e-01, 3.62086377e-02, 5.66684683e-01, 3.74354383e-02, 5.75150706e-01, 3.86807402e-02, 5.83574020e-01, 3.99425760e-02, 5.91954833e-01, 4.12197825e-02, 6.00291991e-01, 4.25137906e-02, 6.08586052e-01, 4.38224218e-02, 6.16840518e-01, 4.51482678e-02, 6.25047010e-01, 4.64881844e-02, 6.33210581e-01, 4.78444721e-02, 6.41330498e-01, 4.92147321e-02, 6.49406457e-01, 5.05997176e-02, 6.57437829e-01, 5.19994402e-02, 6.65424891e-01, 5.34130371e-02, 6.73365527e-01, 5.48408817e-02, 6.81261993e-01, 5.62829118e-02, 6.89112820e-01, 5.77387610e-02, 6.96917569e-01, 
    5.92084124e-02, 7.04676804e-01, 6.06907654e-02, 7.12388919e-01, 6.21864448e-02, 7.20056322e-01, 6.36959453e-02, 7.27677327e-01, 6.52169241e-02, 7.35251395e-01, 6.67509152e-02, 7.42780084e-01, 6.82968268e-02, 7.50261723e-01, 6.98552450e-02, 7.57694987e-01, 7.14248578e-02, 7.65080933e-01, 7.30061767e-02, 7.72421092e-01, 7.45999812e-02, 7.79715201e-01, 7.62034480e-02, 7.86960782e-01, 7.78186727e-02, 7.94158254e-01, 7.94431838e-02, 8.01308594e-01, 8.10788621e-02, 8.08412639e-01, 8.27248866e-02, 8.15467583e-01, 8.43808115e-02, 8.22475965e-01, 8.60466180e-02, 8.29435410e-01, 8.77225935e-02, 8.36347796e-01, 8.94037581e-02, 8.43212899e-01, 9.10960504e-02, 8.50029956e-01, 9.27991800e-02, 8.56797997e-01, 9.45114191e-02, 8.63073983e-01, 9.63926559e-02, 8.69022319e-01, 9.85377838e-02, 8.74642489e-01, 1.00735272e-01, 8.80317474e-01, 1.02780147e-01, 8.86057191e-01, 1.05042479e-01, 8.91718963e-01, 1.07159777e-01, 8.97048492e-01, 1.09554139e-01, 9.02595356e-01, 1.11584343e-01, 9.07947416e-01, 1.13786831e-01, 9.13322214e-01, 1.16095570e-01, 9.18518801e-01, 1.18252575e-01, 9.23729172e-01, 1.20420984e-01, 9.29032259e-01, 1.22695193e-01, 9.33974039e-01, 1.24944904e-01, 
    9.39053318e-01, 1.27232310e-01, 9.43904202e-01, 1.29571610e-01, 9.48770423e-01, 1.31652952e-01, 9.53723055e-01, 1.33831580e-01, 9.58467412e-01, 1.36163095e-01, 9.63097737e-01, 1.38444031e-01, 9.67766615e-01, 1.40617326e-01, 9.72334639e-01, 1.42887757e-01, 9.76881623e-01, 1.44982250e-01, 9.81169226e-01, 1.47246004e-01, 9.85304851e-01, 1.49407243e-01, 9.89677460e-01, 1.51475490e-01, 9.93939722e-01, 1.53879844e-01, 9.98160543e-01, 1.56173269e-01, 1.00227636e+00, 1.58571876e-01, 1.00646412e+00, 1.60709726e-01, 1.01049349e+00, 1.62848536e-01, 1.01430544e+00, 1.65168627e-01, 1.01806480e+00, 1.67523528e-01, 1.02206116e+00, 1.69642417e-01, 1.02569515e+00, 1.71960002e-01, 1.02954363e+00, 1.74372708e-01, 1.03314012e+00, 1.76598253e-01, 1.03671037e+00, 1.78944716e-01, 1.04019410e+00, 1.81096695e-01, 1.04370118e+00, 1.83383095e-01, 1.04706379e+00, 1.85682788e-01, 1.05063123e+00, 1.87957731e-01, 1.05388415e+00, 1.90271961e-01, 1.05704614e+00, 1.92412010e-01, 1.06017350e+00, 1.94878639e-01, 1.06332013e+00, 1.96980936e-01, 1.06637804e+00, 1.99298437e-01, 1.06939395e+00, 2.01482265e-01, 1.07224380e+00, 2.03792393e-01, 1.07527186e+00, 2.06160581e-01, 1.07795654e+00, 
    2.08528197e-01, 1.08079005e+00, 2.10759361e-01, 1.08355490e+00, 2.13080850e-01, 1.08612062e+00, 2.15261609e-01, 1.08873727e+00, 2.17581694e-01, 1.09115229e+00, 2.20026038e-01, 1.09368311e+00, 2.22553213e-01, 1.09610659e+00, 2.24848307e-01, 1.09839765e+00, 2.27231682e-01, 1.10057437e+00, 2.29595649e-01, 1.10281133e+00, 2.31929261e-01, 1.10488615e+00, 2.34338441e-01, 1.10675849e+00, 2.36488337e-01, 1.10892801e+00, 2.38813789e-01, 1.11102016e+00, 2.41136767e-01, 1.11288635e+00, 2.43506915e-01, 1.11481554e+00, 2.45974880e-01, 1.11665293e+00, 2.48139084e-01, 1.11850963e+00, 2.50599969e-01, 1.12037326e+00, 2.52839177e-01, 1.12193003e+00, 2.55253486e-01, 1.12351096e+00, 2.57645697e-01, 1.12515470e+00, 2.59963238e-01, 1.12683432e+00, 2.62228817e-01, 1.12832498e+00, 2.64768297e-01, 1.12965613e+00, 2.66909431e-01, 1.13123306e+00, 2.69470272e-01, 1.13269038e+00, 2.71859351e-01, 1.13382253e+00, 2.74162134e-01, 1.13507471e+00, 2.76270102e-01, 1.13646840e+00, 2.78844982e-01, 1.13756334e+00, 2.81235981e-01, 1.13869237e+00, 2.83726066e-01, 1.13970428e+00, 2.85990150e-01, 1.14093136e+00, 2.88360176e-01, 1.14187297e+00, 2.90863909e-01, 1.14292133e+00, 2.93283934e-01, 
    1.14368459e+00, 2.95646381e-01, 1.14485051e+00, 2.98018224e-01, 1.14547475e+00, 3.00454443e-01, 1.14630940e+00, 3.02770900e-01, 1.14738723e+00, 3.05090841e-01, 1.14800238e+00, 3.07564073e-01, 1.14854700e+00, 3.09784781e-01, 1.14924902e+00, 3.12236728e-01, 1.14981376e+00, 3.14613744e-01, 1.15045254e+00, 3.17000384e-01, 1.15089581e+00, 3.19459482e-01, 1.15156245e+00, 3.21735421e-01, 1.15199196e+00, 3.24296214e-01, 1.15217439e+00, 3.26717532e-01, 1.13513432e+01, 9.86472504e+00, 9.04090609e+00, 1.11362293e+01, 1.28114919e+01, 7.45044774e+00, 4.30277395e+00, 2.64708541e+00, 8.30448884e-01, 3.81163538e-01, 3.90986453e-01, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00    
])
STATE_STD: np.ndarray = np.array([
    3.37610245e-03, 2.01694235e-02, 3.40490809e-03, 2.01650270e-02, 3.47281608e-03, 2.01571246e-02, 3.54007074e-03, 2.01504496e-02, 3.60583607e-03, 2.01502710e-02, 3.67302443e-03, 2.01631432e-02, 3.73951440e-03, 2.01966732e-02, 3.80579450e-03, 2.02598056e-02, 3.87319331e-03, 2.03620812e-02, 3.93902215e-03, 2.05152515e-02, 4.00987641e-03, 2.07296193e-02, 4.08336655e-03, 2.10173560e-02, 4.15622140e-03, 2.13891472e-02, 4.23335880e-03, 2.18562441e-02, 4.31121315e-03, 2.24281566e-02, 4.39329517e-03, 2.31134628e-02, 4.48618771e-03, 2.39184431e-02, 4.58984845e-03, 2.48477790e-02, 4.70347998e-03, 2.59056209e-02, 4.83294294e-03, 2.70936501e-02, 4.97840066e-03, 2.84119788e-02, 5.14251443e-03, 2.98587022e-02, 5.32410481e-03, 3.14338515e-02, 5.52416313e-03, 3.31328405e-02, 5.74274335e-03, 3.49556349e-02, 5.98793255e-03, 3.68954301e-02, 6.25350327e-03, 3.89524192e-02, 6.54449186e-03, 4.11217827e-02, 6.86283762e-03, 4.33995173e-02, 7.21133529e-03, 4.57838085e-02, 7.58840097e-03, 4.82709302e-02, 8.00037725e-03, 5.08571007e-02, 8.44062961e-03, 5.35421967e-02, 8.91252112e-03, 5.63219973e-02, 9.41843492e-03, 5.91934419e-02, 9.95644868e-03, 6.21562550e-02, 1.05282035e-02, 6.52061323e-02, 1.11335156e-02, 6.83425142e-02, 1.17752969e-02, 7.15616087e-02, 1.24536893e-02, 7.48634225e-02, 1.31669939e-02, 7.82463217e-02, 1.39146165e-02, 8.17072264e-02, 1.46954720e-02, 8.52465998e-02, 1.55141137e-02, 8.88601013e-02, 1.63671568e-02, 9.25480618e-02, 1.72547796e-02, 9.63085198e-02, 1.81798960e-02, 1.00141036e-01, 1.91415405e-02, 1.04042903e-01, 2.01374840e-02, 1.08014363e-01, 2.11717652e-02, 1.12052196e-01, 2.22404680e-02, 1.16156029e-01, 2.33441526e-02, 1.20325956e-01, 2.44852129e-02, 1.24559872e-01, 2.56639994e-02, 1.28854587e-01, 2.68792551e-02, 1.33211811e-01, 2.81294767e-02, 1.37629941e-01, 2.94176510e-02, 1.42107313e-01, 3.07414302e-02, 1.46642412e-01, 3.21038194e-02, 1.51235092e-01, 3.35041189e-02, 1.55882119e-01, 3.49398152e-02, 1.60586554e-01, 3.64137252e-02, 1.65344404e-01, 3.79254788e-02, 1.70154881e-01, 3.94733819e-02, 1.75018829e-01, 4.10589337e-02, 1.79932564e-01, 4.26810716e-02, 1.84897794e-01, 4.43437887e-02, 1.89912180e-01, 4.60419500e-02, 1.94974350e-01, 4.77780163e-02, 2.00083970e-01, 4.95512404e-02, 2.05241407e-01, 5.13644490e-02, 2.10442403e-01, 5.32141795e-02, 2.15690426e-01, 5.51007116e-02, 2.20984072e-01, 5.70247576e-02, 2.26320007e-01, 5.89883890e-02, 2.31697629e-01, 6.09902214e-02, 2.37115849e-01, 6.30280402e-02, 2.42576136e-01, 6.51047391e-02, 2.48076460e-01, 6.72204949e-02, 2.53612768e-01, 6.93721436e-02, 2.59190225e-01, 7.15616638e-02, 2.64805531e-01, 7.37895638e-02, 2.70457001e-01, 7.60554212e-02, 2.76144086e-01, 7.83575160e-02, 2.81867331e-01, 8.06978659e-02, 2.87623891e-01, 8.30756966e-02, 2.93412188e-01, 8.54908161e-02, 2.99234845e-01, 8.79438132e-02, 3.05092086e-01, 9.04345664e-02, 3.10977626e-01, 9.29608969e-02, 3.16895625e-01, 9.55261428e-02, 3.22842074e-01, 9.81281906e-02, 3.28819373e-01, 1.00766778e-01, 3.34824125e-01, 1.03443033e-01, 3.40856795e-01, 1.06155826e-01, 3.46916237e-01, 1.08904550e-01, 3.53007633e-01, 1.11690704e-01, 3.59124546e-01, 1.14514091e-01, 3.65261222e-01, 1.17372991e-01, 3.71420433e-01, 1.29382278e-01, 3.79948793e-01, 1.52065179e-01, 3.94211024e-01, 1.73518003e-01, 4.07888727e-01, 1.92263271e-01, 4.21689991e-01, 2.09936118e-01, 4.33809504e-01, 2.26055458e-01, 4.46388573e-01, 2.42348617e-01, 4.58975868e-01, 2.55532233e-01, 4.70658444e-01, 2.69783183e-01, 4.82761008e-01, 2.83013215e-01, 4.94370271e-01, 2.96143208e-01, 5.05846095e-01, 3.09094654e-01, 5.16955535e-01, 3.20150625e-01, 5.27407987e-01, 3.31552436e-01, 5.38114104e-01, 3.43240360e-01, 5.48941832e-01, 3.55057252e-01, 5.59180980e-01, 3.65913348e-01, 5.69684311e-01, 3.76196650e-01, 5.79305076e-01, 3.86900735e-01, 5.89295065e-01, 3.97700249e-01, 5.99382300e-01, 4.07699419e-01, 6.08948371e-01, 4.17545592e-01, 6.18634271e-01, 4.27889398e-01, 6.28047643e-01, 4.37551991e-01, 6.37650663e-01, 4.47815295e-01, 6.47307847e-01, 4.57137417e-01, 6.56255425e-01, 4.66981479e-01, 6.65735213e-01, 4.76248179e-01, 6.74633612e-01, 4.85483962e-01, 6.84152173e-01, 4.94401209e-01, 6.92907971e-01, 5.03122764e-01, 7.01399775e-01, 5.12567770e-01, 7.10209004e-01, 5.21950474e-01, 7.19123193e-01, 5.29843261e-01, 7.27879432e-01, 5.39083202e-01, 7.36328632e-01, 5.47866657e-01, 7.44954557e-01, 5.55664261e-01, 7.53502046e-01, 5.64472283e-01, 7.61752597e-01, 5.72843581e-01, 7.69906809e-01, 5.80954047e-01, 7.78608285e-01, 5.89267476e-01, 7.86742138e-01, 5.96774365e-01, 7.94759978e-01, 6.05262020e-01, 8.02959481e-01, 6.12771671e-01, 8.10847020e-01, 6.21402029e-01, 8.19532582e-01, 6.29537971e-01, 8.27321351e-01, 6.37038428e-01, 8.35546961e-01, 6.44830635e-01, 8.43339889e-01, 6.52939503e-01, 8.51221734e-01, 6.60599350e-01, 8.59020636e-01, 6.68398555e-01, 8.67186301e-01, 6.76029963e-01, 8.74667928e-01, 6.83524755e-01, 8.82558446e-01, 6.91362232e-01, 8.90463495e-01, 6.98384239e-01, 8.98084141e-01, 7.06312871e-01, 9.05871765e-01, 7.14063690e-01, 9.13769477e-01, 7.21037503e-01, 9.21367116e-01, 7.28277123e-01, 9.29055034e-01, 7.36224037e-01, 9.36638992e-01, 7.43309012e-01, 9.44294821e-01, 7.51221681e-01, 9.51453564e-01, 7.59122286e-01, 9.59197722e-01, 7.65771386e-01, 9.66462383e-01, 7.72990099e-01, 9.73970392e-01, 7.80618324e-01, 9.81430564e-01, 7.87357924e-01, 9.88838099e-01, 7.94513453e-01, 9.96181081e-01, 8.01414756e-01, 1.00340736e+00, 8.08317189e-01, 1.01077841e+00, 8.15407353e-01, 1.01827125e+00, 8.22610507e-01, 1.02535218e+00, 8.29495423e-01, 1.03240359e+00, 8.35935057e-01, 1.03947260e+00, 8.42988817e-01, 1.04688817e+00, 8.49865550e-01, 1.05399672e+00, 8.56194926e-01, 1.06077904e+00, 8.62817514e-01, 1.06783969e+00, 8.69930266e-01, 1.07505967e+00, 8.76744770e-01, 1.08190734e+00, 8.83331625e-01, 1.08899793e+00, 8.89821878e-01, 1.09599449e+00, 8.96395082e-01, 1.10283684e+00, 9.03214715e-01, 1.10998794e+00, 9.09457514e-01, 1.11660284e+00, 9.16144056e-01, 1.12316011e+00, 9.22526133e-01, 1.13029755e+00, 9.29147631e-01, 1.13713576e+00, 9.35064168e-01, 1.14365895e+00, 9.41937149e-01, 1.15063658e+00, 9.48155272e-01, 1.15727633e+00, 9.54130781e-01, 1.16381226e+00, 9.60764575e-01, 1.17054950e+00, 9.67380678e-01, 1.17737868e+00, 9.73166137e-01, 1.18401929e+00, 9.79580875e-01, 1.19047674e+00, 9.85540541e-01, 1.19703790e+00, 9.91999333e-01, 1.20353601e+00, 9.97832737e-01, 1.21015069e+00, 1.00394000e+00, 1.21667830e+00, 1.01048356e+00, 1.22319337e+00, 7.78704859e+00, 7.91734143e+00, 5.50161832e+00, 6.11094829e+00, 6.81652683e+00, 8.05089539e+00, 7.13040442e+00, 5.81628043e+00, 3.01577558e+00, 1.72912843e+00, 2.75294422e+00, 1.00000000e-06, 1.00000000e-06, 1.00000000e-06, 1.00000000e-06
])
# Set environment variable
os.environ['PYTORCH_CUDA_ALLOC_CONF'] = 'expandable_segments:True'
REFERENCE_POSE: List[float] = [0.15, 0.950, np.pi, 0.0, 0.0, 0.0]
IMAGE_SIZE: tuple = (84, 84)

# HITL settings
IP: str = "127.0.0.1"
HITL_PORT: int = 5000

print_QCar_info: bool = False  # print "QCar configured successfully." in qcar.py or not
max_action: float = 0.5
discount: float = 0.99
state_dim: int = 400
action_dim: int = 2
lr: float = 1e-4  # 3e-4
tau: float = 0.005
observation_shape: tuple = (10,)
buffer_update_rate: int = 2
policy_freq: int = 10  # 2
# generator constants
METRIC_PREFIX: str = 'agent'
COOL_DOWN_TIME: float = 3.0
# trainer constants
MAX_TRAINING_STEPS: int = 100_000_000000
SAVE_INTERVAL: int = 30
LOGBATCH_INTERVAL: int = 400
LOG_INTERVAL: int = 10
QCAR_POS: list = []
# env constants
MAX_LOOKAHEAD_INDICES: int = 200
GOAL_THRESHOLD: int = 0.05
RECOVER_INDICES: list = [0, 6, 8]

# settings
DEFAULT_MAX_STEPS: int = 2000
# batch_size = 2048
# PREFILL = 10000
batch_size: int = 2048
PREFILL: int = 3_400_000
RUN_ID = 'e4eef53e8c3a49a0b2967fa6be338fd2'
# RUN_ID: str = ''
action_v: float = 0.08
cuda: str = "cuda:1"
# start_point = 1700